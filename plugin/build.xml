<project name="MosaicToolbox" default="" basedir=".">
    <description>
        Mosaic Toolbox build file
    </description>
	<property name="src" location="src" />
	<property name="build" location="bin" />
	<property name="dist"  location="dist" />
 
	<property name="pluginsDir"  location="$basedir/../../IJ/plugins/Mosaic_Toolbox" />
 
	<property name="user.name" value="Mosaic" />
	<property name="jarfilename" value="Mosaic_Toolbox"/>
		
	<property name="scala.home" value="/usr/local/scala/"/>
	<property name="scala-compiler.jar" value="${scala.home}/lib/scala-compiler.jar"/>
	<property name="scala-library.jar" value="${scala.home}/lib/scala-library.jar"/>
	
	<target name="main" depends="clean,build,compress" description="Main target">
		<echo>
			Clean, compile and compressing the .jar file.
		</echo>
	</target>
	
	<target name="compress" depends="" description="generate the distribution">
		<echo>
			Building the .jar file.
		</echo>
	 	<jar jarfile="${pluginsDir}/${jarfilename}.jar" update="true">
	 		<fileset dir="." includes="plugins.config" />
			<fileset dir="${build}" includes="**/*.*" />
			<fileset dir="." includes="macros/*.ijm" /> 
	 		
	 		<!--Add Scala, Scalala and there dependencies to Mosaic Toolbox jar -->
	 		
	 			<fileset dir="../Scalala/target/classes/" includes="**/*.*" />
	 			<!--<zipfileset src="${scala-library.jar} " includes="**/*.class"/>	-->
	 		
	 			<!-- Add needed libs directly to the IJ eclipse project and not into the MosaicToobox.jar, for faster debugging -->
	 			<!-- <zipgroupfileset dir="../lib" includes="*.jar"/>-->	
	 		
			<manifest>
	 			<attribute name="Built-By" value="${user.name}"/>
	 		</manifest>
	 	</jar>
	</target>
	
	<target name="clean" description="deletes all binaries and jars">
		<echo>
			Deleting files...
		</echo>
		<delete>
			<fileset dir="${pluginsDir}" includes="${jarfilename}.jar" />
		</delete>
		<delete>
			<fileset dir="${build}" includes="*.class" />
		</delete>
		<echo>
			... done.
		</echo>
	</target>
	
	<path id="scala.classpath">
		<pathelement location="${scala-compiler.jar}"/>
		<pathelement location="${scala-library.jar}"/>
	</path>
	
	<!-- classpath for project build -->   
	    <path id="build.classpath">
	      <pathelement location="${scala-library.jar}"/>
	      <fileset dir="../lib">
	        <include name="*.jar"/>
	      </fileset>
	      <pathelement location="${build}"/>
	    	
	    	<!-- classpath IJ --> 	
	      <pathelement location="../IJ/bin"/>
	    	<!-- classpath Scalala -->
	    	<pathelement location="../Scalala/target/classes"/>
	    	<fileset dir="../Scalala/lib">
	    		        <include name="*.jar"/>
	    	</fileset>
	    </path>

	
	<taskdef resource="scala/tools/ant/antlib.xml">
		<classpath refid="scala.classpath"/>
	</taskdef>
	
	<target name="build">
	    <scalac srcdir="src/" destdir="bin/" classpathref="build.classpath" scalacdebugging="true">
	        <include name="**/*.scala"/>
	        <include name="**/*.java"/>
	    </scalac>
	 
	    <javac srcdir="src/" destdir="bin" 
	           classpath="bin"/>
	</target>
</project>