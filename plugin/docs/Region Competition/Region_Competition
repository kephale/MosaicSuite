<html>
  <head>
    <title>Region Competition</title>
    <meta content="">
    <style></style>
  </head>
  <body>
<h2>Region Competition</h2>
  This plugins is based on the MOSAIC Discrete region competition algorithm, for image segmentation
<p>J.&nbsp;Cardinale, G.&nbsp;Paul, and I.&nbsp;F. Sbalzarini. Discrete region competition for unknown numbers of connected regions. <em>IEEE Trans. Image Process.</em>, 21(8):3531-3545, 2012. (<a href="http://www.mosaic.ethz.ch/research/pubs/docs/Cardinale2012.pdf" target="_blank">PDF</a>)</p>

<h2>Installation</h2>
Copy the mosaic plugins.jar file into the ImageJs plugins directory, restart ImageJ.
The plugin can be launched from the Mosaic submenu in ImageJs plugin menu.
The plugin handles 8-bit, 16-bit and 32-bit grayscale images or stacks.


<h2>Algorithm and Interface</h2>

The algorithm require the following inputs and produce the following outputs<br>
<br>
<table>
  <tbody>
    <tr>
      <td><h3>Inputs</h3></td>
      <td><h3>Outputs</h3></td>
    </tr>
    <tr>
      <td><strong>Image source</strong></td>
      <td><strong>Label output image</strong></td>
    </tr>
    <tr>
      <td><strong>Energy function</strong></td>
      <td><strong>Intensity normalized image</strong></td>
    </tr>
    <tr>
      <td><strong>Energy function parameters</strong></td>
      <td><strong>Animated iteration sequence</strong></td>
    </tr>
    <tr>
      <td><strong>Label image source (optional)</strong></td>
      <td></td>
    </tr>
  </tbody>
</table>
<br>
<br>
<strong>Image source:</strong> Can be in any format recognized by ImageJ, the image is automaticaly converted into a floating point intensity image<br>
<strong>Intensity normalized image:</strong> All pixels of the original image are rescaled so that each pixel is ranged from 0.0 to 1.0<br>
<strong>Label image source:</strong> Is the segmented image produced by the algorithm, it can be saved in all imageJ supported formats<br>
<strong>Animated sequence:</strong> Is the evolution of the segmentation produced by the algorithm, can be saved in all imageJ supported formats<br>
<strong>Energy function:</strong> The segmentation is driven by the minimization of an energy function. In this plugin several energy functions or combinations of energy functions can be selected. In the following we introduce briefly all them, but for a complete explanation of which one use and in which situation use the paper [1].
<strong>Label image source:</strong> This is an optional image that defines the initial segmentation from which the algoritm  should start. If not given the default behaviour is to use an autogenerated starting labels image.<br>
<strong>Energy function parameters:</strong>The energy function in general have free parameter, that should be setted by the user or initialized to some default value.

<h2>Step by step tutorial</h2>

<table>
  <tbody>
    <tr>
      <td><IMG src="images/RegionCM.jpg" width="579" height="422" align="left" border="0"></td>
      <td><h3>Select an image</h3>
Press OpenImage button and choose the file, or drag and drop the file inside the rectangle. if the file is is already opened in ImageJ, choose it from the input selector.</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td><IMG src="images/RegionPAR.jpg" width="617" height="341" align="left" border="0"></td>
      <td><h3>Select paramenters</h3>
Press Parameters button in the main window, you can tune global parameters like the maxium number of iteration and the oscillation threshold that control the convergence of the algorithm. You can also tune global parameters related to the energy, like Lambda and Theta that we will explain below.<br>
<br>
<strong>Lambda E length</strong>: Lambda E length: Is a scaling factor for the Energy length, this term in general is sensitive to the shape of the region<br>
<strong>Theta E merge</strong>:  Is a factor needed for the merging energy function, this term implements model that controls the merging of two regions<br>
<strong>Max Iteration</strong>: Is the maximum number of iteration<br>
<strong>Oscillation Threadshold</strong>: This parameter controls the convergence of the algorithm in this way, at each iteration the global energy is stored, the standard deviation is calculated along all history and starting from the last 10 iterations. <IMG src="images/Oscillation.jpg" width="182" height="57" align="left" border="0"> Each time the event in fig A occurs the number of fixed particles needed to converge is reduced by a factor two<br>
    </tr>
  </tbody>
</table>


<h3>E data</h3>
<br>
This is the Energy part that depend from the input image, each model have an "options window" that can be opened pressing the near "Options" button<br>
<br>
<table>
  <tbody>
    <tr>
      <td><IMG src="images/E_pc.jpg" width="253" height="79" align="left" border="0"></td>
      <td><h3>PC</h3><br> No Additional options are available</td>
    </tr>
    <tr>
      <td><IMG src="images/E_ps.jpg" width="503" height="254" align="left" border="0"></td>
      <td><h3>PS</h3><br>
	<strong>Radius</strong>: Radius of the sphere where the mean of the intensity is calculated<br>
	<strong>Beta Balloon force</strong>: Beta controls the strenght of the Balloon force<br>
      </td>
    </tr>
    <tr>
      <td><IMG src="images/E_dev.jpg" width="425" height="304" align="left" border="0"></td>
      <td><h3>Deconvolution</h3><br>
	<strong>Open PSF Image</strong>: Open an image and use it as Point Spread Function<br>
	<strong>Generate:</strong>Generate a gaussian PSF Image, before starting the simulation<br>
      </td>
    </tr>
  </tbody>
</table>
<br>
Use paper [1] for a detailed explanation of each model, term and parameter
<br>
<br>
<h3>Energy length model</h3>
<table>
  <tbody>
    <tr>
      <td>
	<IMG src="images/Cont_lenght_lf.gif" width="100" height="100" align="left" border="0">
      </td>
      <td>
	From a practical point of view, this energy locally reduces concavity, tips , and globally the length of the countor region. The image show what happen when the segmentation is driven only by the Sphere Regularization energy term
      </td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>
<IMG src="images/E_lenght.jpg" width="301" height="242" align="left" border="0">
      </td>
      <td>
<h3>Sphere Regularization</h3><br>
	<strong>Radius</strong>: Radius of the hypersphere in the curvature regularization<br>
      </td>
    </tr>
    <tr>
      <td>
<IMG src="images/E_lenght_approximative.jpg" width="120" height="24" align="left" border="0">
      </td>
      <td>
<h3>Approximative</h3><br>
	Countor length regularization, no other parameters needed<br>
      </td>
    </tr>
   </tbody>
</table>


<h3>Energy Merge</h3>

<table>
  <tbody>
    <tr>
      <td>
<IMG src="images/E_merge.jpg" width="378" height="31" align="left" border="0">
      </td>
      <td>
<h3>Kullback-Leibler</h3>
This parameter is controlled in the global region competition parameters (Theta E Merge)
      </td>
    </tr>
   </tbody>
</table>

<h3>Initialization</h3>


<table>
  <tbody>
    <tr>
      <td>
<IMG src="images/bubbles.jpg" width="350" height="268" align="left" border="0">
      </td>
      <td>
<h3>Bubbles</h3>
Create a grid of bubbles with a specified radius and padding
      </td>
    </tr>
    <tr>
      <td>
<IMG src="images/Rectangle.jpg" width="319" height="228" align="left" border="0">
      </td>
      <td>
<h3>Rectangle</h3>
Create a rectangle in the center of the image, the ratio is the division of the side of the rectangle with the side of the image on each dimension
      </td>
    </tr>
    <tr>
      <td>
      </td>
      <td>
<h3>ROI</h3>
Before the simulation start, the normalized intensity image is shown, and it ask to user to draw a starting region using the selection tools of ImageJ, when done press shift to start the simulation
      </td>
    </tr>
    <tr>
      <td>
      </td>
      <td>
<br>
<br>
<h3>Local Maxima</h3>
Initial regions are created around local maxima of the image
      </td>
    </tr>
   </tbody>
</table>

<h3>Handle, fission, fusion</h3>

The algorithm is able to manage changes of topology, you can enable or disable the creation of handles, and fission and fusion of regions

<table>
  <tbody>
    <tr>
      <TD>
<IMG src="images/Fusion_on.jpg" width="70" height="28" align="left" border="0">
      </TD>
      <TD>
<IMG src="images/Fusion_off.jpg" width="72" height="31" align="left" border="0">
      </TD>
      <TD>
<IMG src="images/Fission_on.jpg" width="76" height="28" align="left" border="0">
      </TD>
      <TD>
<IMG src="images/Fission_off.jpg" width="72" height="31" align="left" border="0">
      </TD>
      <TD>
<IMG src="images/Handles_on.jpg" width="77" height="28" align="left" border="0">
      </TD>
      <TD>
<IMG src="images/Handles_off.jpg" width="97" height="31" align="left" border="0">
      </TD>
    </tr>
    <tr>
      <TD>
<IMG src="images/Ball_region_ffusion.gif" width="100" height="100" align="left" border="0">
      </TD>
      <TD>
<IMG src="images/Ball_region_fusion.gif" width="100" height="100" align="left" border="0">
      </TD>
      <TD>
<IMG src="images/flo_fission.gif" width="100" height="100" align="left" border="0">
      </TD>
      <TD>
<IMG src="images/flo_no_fission.gif" width="100" height="100" align="left" border="0">
      </TD>
      <TD>
<IMG src="images/Ball_with_holes_H.gif" width="100" height="100" align="left" border="0">
      </TD>
      <TD>
<IMG src="images/Ball_with_holes_nH.gif" width="100" height="100" align="left" border="0">
      </TD>
    </tr>
  </tbody>
</table>

<h3>Other options</h3>

<table>
  <tbody>
    <tr>
<TD>
<br>
<strong>Show progress</strong>: Show the progress of the segmentation process during computation<br>
<strong>Keep frames</strong>: Save all frames produced by the algorithm<br>
<strong>Show normalized</strong>: Show the floating point normalized image<br>
<strong>Show statistics</strong>: Show statistics of the segmentation<br>
<IMG src="images/statistics.jpg" width="462" height="256" align="left" border="0">
</TD>
    </tr>
  </tbody>
</table>


<h2>Examples</h2>


<table>
  <tbody>
      <tr>
      <td><IMG src="images/nucleis.jpg" width="198" height="238" align="left" border="0"></td>
      <td><IMG src="images/nucleis.gif" width="198" height="238" align="left" border="0"></td>
      <td><trong><h2>PC</h2>
      <strong>Oscillation threshold</strong>: 0.001<br>
      <strong>Theta E merge</strong>: 0.01<br>
      <strong>Lambda E length</strong>: 0.4<br>
      <strong>R_k</strong>: 12<br>
      <strong>Bubble radius</strong>: 10<br>
      <strong>Bubble padding</strong>: 17<br>
      </td>
    </tr>
    <tr>
      <td><IMG src="images/icecream5_410x410.jpg" width="410" height="410" align="left" border="0"></td>
      <td><IMG src="images/icecream5_rs.gif" width="410" height="410" align="left" border="0"></td>
      <td><trong><h2>PC</h2>
      <strong>Oscillation threshold</strong>: 0.00001<br>
      <strong>Theta E merge</strong>: 0.2<br>
      <strong>Lambda E length</strong>: 0.04<br>
      <strong>R_k</strong>: 8<br>
      <strong>Bubble radius</strong>: 20<br>
      <strong>Bubble padding</strong>: 20<br>
      </td>
    </tr>
    <tr>
    </tr>
    <tr>
      <td>
	<video width="492" height="324" controls="controls" autoplay="autoplay" loop="loop">
	<source src="images/3D_scr.mp4"></source>
	<source type="video/mp4" src="images/3D_scr.mp4"></source>
	<source type="video/webm" src="images/3D_scr.webm"></source>
	<source type="video/ogg" src="images/3D_scr.ogg"></source>
	</video>
      </td>
      <td>
	<video width="492" height="324" controls="controls" autoplay="autoplay" loop="loop">
	<source src="images/3D.mp4"></source>
	<source type="video/mp4" src="images/3D.mp4"></source>
	<source type="video/webm" src="images/3D.webm"></source>
	<source type="video/ogg" src="images/3D.ogg"></source>
	</video>
      </td>
      <td><h2>PS</h2>
      <strong>Oscillation threshold</strong>: 0.02<br>
      <strong>Theta E merge</strong>: 0.2<br>
      <strong>Lambda E length</strong>: 0.07<br>
      <strong>R_k</strong>: 4<br>
      <strong>Rectangle fill ratio</strong>: 0.80<br></td>
    </tr>
    <tr>
      <td><IMG src="images/icecream_shaded_130x130.jpg" width="260" height="260" align="left" border="0"></td>
      <td><IMG src="images/ps_bubble_rs.gif" width="260" height="260" align="left" border="0"></td>
      <td><h2>PS</h2>
      <strong>Oscillation threshold</strong>: 0.01<br>
      <strong>Theta E merge</strong>: 0.4<br>
      <strong>Lambda E length</strong>: 0.08<br>
      <strong>R_k</strong>: 4<br>
      <strong>PS Radius</strong>: 4<br>
      <strong>Beta Ballon</strong>: 0.01<br>
      <strong>Rectangle fill ratio</strong>: 0.80<br></td>
    </tr>
    <tr>
      <td><IMG src="images/endo.jpg" width="512" height="386" align="left" border="0"></td>
      <td><IMG src="images/endo.gif" width="512" height="386" align="left" border="0"></td>
      <td><h2>Deconvolution</h2>
      <strong>Oscillation threshold</strong>: 0.8<br>
      <strong>Theta E merge</strong>: 0.1<br>
      <strong>Lambda E length</strong>: 0.15<br>
      <strong>R_k</strong>: 2<br>
      <strong>Local Maxima</strong></td>
    </tr>
    <tr>
      <td><IMG src="images/uc_data.jpg" width="196" height="288" align="left" border="0"></td>
      <td><IMG src="images/Dev_res_rs.gif" width="196" height="288" align="left" border="0"></td>
      <td><h2>Deconvolution</h2>
      <strong>Oscillation threshold</strong>: 0.18<br>
      <strong>Theta E merge</strong>: 0.2<br>
      <strong>Lambda E length</strong>: 0.07<br>
      <strong>R_k</strong>: 4<br>
      <strong>Rectangle fill ratio</strong>: 0.80<br></td>
    </tr>
  </body>
</html>
